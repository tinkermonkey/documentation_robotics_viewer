# AUTO-GENERATED: This OpenAPI specification is programmatically generated.
# DO NOT EDIT MANUALLY - all changes will be overwritten on next generation.
# To update this spec, modify the route schemas in server.ts (using Zod schemas),
# then regenerate with: npm run generate:openapi
# This ensures the specification always matches the actual implementation.

openapi: 3.0.3
info:
  title: Documentation Robotics Visualization Server API
  version: 0.1.0
  description: API specification for the DR CLI visualization server
  contact:
    name: Documentation Robotics
    url: https://github.com/tinkermonkey/documentation_robotics
  license:
    name: ISC
servers:
  - url: http://localhost:8080
    description: Local development server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: "API token (shown at server startup, pass as Authorization: Bearer
        <token>)"
  schemas: {}
  parameters: {}
paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the server is running and healthy
      responses:
        "200":
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Server health status
                  version:
                    type: string
                    description: API version
                required:
                  - status
                  - version
  /api/model:
    get:
      tags:
        - Model
      summary: Get full model
      description: Retrieve the complete architecture model across all layers
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Model data retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  nodes:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Element ID (UUID for spec-node aligned elements)
                        elementId:
                          type: string
                          description: Stable semantic ID in layer.type.name format (e.g.
                            motivation.goal.my-goal). Present only on
                            legacy-format elements. Use this field — not id —
                            when calling the annotation API. Elements without
                            this field (pure spec-node format) do not yet
                            support annotation creation.
                        spec_node_id:
                          type: string
                          description: Spec node type ID (e.g. motivation.goal)
                        type:
                          type: string
                          description: Element type (e.g. goal, endpoint)
                        layer_id:
                          type: string
                          description: Layer this element belongs to
                        name:
                          type: string
                          description: Element display name
                        description:
                          type: string
                          description: Element description
                        attributes:
                          type: object
                          additionalProperties: {}
                          description: Typed attribute bag per spec-node schema
                        source_reference:
                          type: object
                          properties:
                            provenance:
                              type: string
                              enum:
                                - extracted
                                - manual
                                - inferred
                                - generated
                            locations:
                              type: array
                              items:
                                type: object
                                properties:
                                  file:
                                    type: string
                                  symbol:
                                    type: string
                                required:
                                  - file
                            repository:
                              type: object
                              properties:
                                url:
                                  type: string
                                commit:
                                  type: string
                          required:
                            - provenance
                            - locations
                          description: Source code provenance linking this element to its implementation
                        metadata:
                          type: object
                          properties:
                            created_at:
                              type: string
                            updated_at:
                              type: string
                            created_by:
                              type: string
                            version:
                              type: number
                          description: Element lifecycle metadata (timestamps, version)
                        properties:
                          type: object
                          additionalProperties: {}
                          description: Legacy property bag (deprecated — prefer attributes)
                      required:
                        - id
                        - spec_node_id
                        - type
                        - layer_id
                        - name
                    description: All architecture elements across all layers
                  links:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Stable link ID derived from source, target, and type
                        source:
                          type: string
                          description: Source element ID
                        target:
                          type: string
                          description: Target element ID
                        type:
                          type: string
                          description: Relationship predicate or reference type
                        layer_id:
                          type: string
                          description: Layer ID for intra-layer relationships
                        source_layer_id:
                          type: string
                          description: Source layer ID for cross-layer references
                        target_layer_id:
                          type: string
                          description: Target layer ID for cross-layer references
                      required:
                        - id
                        - source
                        - target
                        - type
                    description: Intra-layer relationships and cross-layer references
                required:
                  - nodes
                  - links
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
  /api/layers/:layerName:
    get:
      tags:
        - Model
      summary: Get layer
      description: Retrieve a specific layer with all its elements
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            enum:
              - motivation
              - business
              - security
              - application
              - technology
              - api
              - data-model
              - data-store
              - ux
              - navigation
              - apm
              - testing
          required: true
          name: layerName
          in: path
      responses:
        "200":
          description: Layer retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    description: Layer name
                  elements:
                    type: array
                    items:
                      type: object
                      properties: {}
                      additionalProperties: {}
                    description: Layer elements (each element is an object with id, name, type, and
                      properties)
                  elementCount:
                    type: number
                    description: Total element count
                required:
                  - name
                  - elements
                  - elementCount
        "404":
          description: Layer not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
  /api/spec:
    get:
      tags:
        - Schema
      summary: Get JSON schemas
      description: Retrieve all JSON Schema definitions used by the system
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Schemas retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    description: Spec version
                  type:
                    type: string
                    description: Response type
                  description:
                    type: string
                    description: Response description
                  source:
                    type: string
                    description: Schema source
                  schemas:
                    type: object
                    additionalProperties: {}
                    description: JSON schema definitions (each schema is a JSON Schema object)
                  schemaCount:
                    type: number
                    description: Number of schemas
                required:
                  - version
                  - type
                  - description
                  - source
                  - schemas
                  - schemaCount
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
  /api/annotations:
    get:
      tags:
        - Annotations
      summary: Get annotations
      description: Retrieve all annotations, optionally filtered by element
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*$
          required: false
          name: elementId
          in: query
        - schema:
            type: string
          required: false
          name: author
          in: query
        - schema:
            type: string
          required: false
          name: tags
          in: query
        - schema:
            type: string
            enum:
              - "true"
              - "false"
          required: false
          name: resolved
          in: query
      responses:
        "200":
          description: Annotations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  annotations:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Annotation ID
                        elementId:
                          type: string
                          minLength: 1
                          pattern: ^[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*$
                          description: Target element ID
                        author:
                          type: string
                          description: Author name
                        content:
                          type: string
                          description: Annotation content
                        createdAt:
                          type: string
                          description: Creation timestamp
                        updatedAt:
                          type: string
                          description: Last update timestamp
                        tags:
                          type: array
                          items:
                            type: string
                          description: Annotation tags
                        resolved:
                          type: boolean
                          description: Resolution status
                        replies:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: string
                              author:
                                type: string
                              content:
                                type: string
                              createdAt:
                                type: string
                            required:
                              - id
                              - author
                              - content
                              - createdAt
                          description: Annotation replies
                      required:
                        - id
                        - elementId
                        - author
                        - content
                        - createdAt
                    description: List of annotations
                required:
                  - annotations
    post:
      tags:
        - Annotations
      summary: Create annotation
      description: Create a new annotation on a model element
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                elementId:
                  type: string
                  minLength: 1
                  pattern: ^[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*$
                author:
                  type: string
                  minLength: 1
                  maxLength: 100
                  default: Anonymous
                content:
                  type: string
                  minLength: 1
                  maxLength: 5000
                tags:
                  type: array
                  items:
                    type: string
                    minLength: 1
                    maxLength: 50
                    pattern: ^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$
                  default: []
              required:
                - elementId
                - content
              additionalProperties: false
      responses:
        "201":
          description: Annotation created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Annotation ID
                  elementId:
                    type: string
                    minLength: 1
                    pattern: ^[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*$
                    description: Target element ID
                  author:
                    type: string
                    description: Author name
                  content:
                    type: string
                    description: Annotation content
                  createdAt:
                    type: string
                    description: Creation timestamp
                  updatedAt:
                    type: string
                    description: Last update timestamp
                  tags:
                    type: array
                    items:
                      type: string
                    description: Annotation tags
                  resolved:
                    type: boolean
                    description: Resolution status
                  replies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        author:
                          type: string
                        content:
                          type: string
                        createdAt:
                          type: string
                      required:
                        - id
                        - author
                        - content
                        - createdAt
                    description: Annotation replies
                required:
                  - id
                  - elementId
                  - author
                  - content
                  - createdAt
        "400":
          description: Invalid request body
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "404":
          description: Element not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
  /api/annotations/:annotationId:
    get:
      tags:
        - Annotations
      summary: Get annotation by ID
      description: Retrieve a specific annotation by its ID
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z0-9_-]+$
          required: true
          name: annotationId
          in: path
      responses:
        "200":
          description: Annotation retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Annotation ID
                  elementId:
                    type: string
                    minLength: 1
                    pattern: ^[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*$
                    description: Target element ID
                  author:
                    type: string
                    description: Author name
                  content:
                    type: string
                    description: Annotation content
                  createdAt:
                    type: string
                    description: Creation timestamp
                  updatedAt:
                    type: string
                    description: Last update timestamp
                  tags:
                    type: array
                    items:
                      type: string
                    description: Annotation tags
                  resolved:
                    type: boolean
                    description: Resolution status
                  replies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        author:
                          type: string
                        content:
                          type: string
                        createdAt:
                          type: string
                      required:
                        - id
                        - author
                        - content
                        - createdAt
                    description: Annotation replies
                required:
                  - id
                  - elementId
                  - author
                  - content
                  - createdAt
        "404":
          description: Annotation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
    put:
      tags:
        - Annotations
      summary: Update annotation (partial)
      description: "Update an existing annotation with partial fields (NOTE: partial
        updates, use PATCH for recommended behavior)"
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z0-9_-]+$
          required: true
          name: annotationId
          in: path
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 5000
                tags:
                  type: array
                  items:
                    type: string
                    minLength: 1
                    maxLength: 50
                    pattern: ^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$
                resolved:
                  type: boolean
              additionalProperties: false
      responses:
        "200":
          description: Annotation updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Annotation ID
                  elementId:
                    type: string
                    minLength: 1
                    pattern: ^[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*$
                    description: Target element ID
                  author:
                    type: string
                    description: Author name
                  content:
                    type: string
                    description: Annotation content
                  createdAt:
                    type: string
                    description: Creation timestamp
                  updatedAt:
                    type: string
                    description: Last update timestamp
                  tags:
                    type: array
                    items:
                      type: string
                    description: Annotation tags
                  resolved:
                    type: boolean
                    description: Resolution status
                  replies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        author:
                          type: string
                        content:
                          type: string
                        createdAt:
                          type: string
                      required:
                        - id
                        - author
                        - content
                        - createdAt
                    description: Annotation replies
                required:
                  - id
                  - elementId
                  - author
                  - content
                  - createdAt
        "404":
          description: Annotation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
    patch:
      tags:
        - Annotations
      summary: Partially update annotation
      description: Partially update an existing annotation (recommended over PUT)
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z0-9_-]+$
          required: true
          name: annotationId
          in: path
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                  minLength: 1
                  maxLength: 5000
                tags:
                  type: array
                  items:
                    type: string
                    minLength: 1
                    maxLength: 50
                    pattern: ^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$
                resolved:
                  type: boolean
              additionalProperties: false
      responses:
        "200":
          description: Annotation updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Annotation ID
                  elementId:
                    type: string
                    minLength: 1
                    pattern: ^[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*\.[a-z][a-z0-9-]*$
                    description: Target element ID
                  author:
                    type: string
                    description: Author name
                  content:
                    type: string
                    description: Annotation content
                  createdAt:
                    type: string
                    description: Creation timestamp
                  updatedAt:
                    type: string
                    description: Last update timestamp
                  tags:
                    type: array
                    items:
                      type: string
                    description: Annotation tags
                  resolved:
                    type: boolean
                    description: Resolution status
                  replies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        author:
                          type: string
                        content:
                          type: string
                        createdAt:
                          type: string
                      required:
                        - id
                        - author
                        - content
                        - createdAt
                    description: Annotation replies
                required:
                  - id
                  - elementId
                  - author
                  - content
                  - createdAt
        "404":
          description: Annotation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
    delete:
      tags:
        - Annotations
      summary: Delete annotation
      description: Delete an existing annotation
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z0-9_-]+$
          required: true
          name: annotationId
          in: path
      responses:
        "204":
          description: Annotation deleted successfully
        "404":
          description: Annotation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
  /api/annotations/:annotationId/replies:
    get:
      tags:
        - Annotations
      summary: Get annotation replies
      description: Retrieve all replies to an annotation
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z0-9_-]+$
          required: true
          name: annotationId
          in: path
      responses:
        "200":
          description: Replies retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  replies:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          description: Reply ID
                        author:
                          type: string
                          description: Author name
                        content:
                          type: string
                          description: Reply content
                        createdAt:
                          type: string
                          description: Creation timestamp
                      required:
                        - id
                        - author
                        - content
                        - createdAt
                    description: List of replies
                required:
                  - replies
        "404":
          description: Annotation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
    post:
      tags:
        - Annotations
      summary: Create annotation reply
      description: Add a reply to an annotation
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z0-9_-]+$
          required: true
          name: annotationId
          in: path
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                author:
                  type: string
                  minLength: 1
                  maxLength: 100
                content:
                  type: string
                  minLength: 1
                  maxLength: 5000
              required:
                - author
                - content
              additionalProperties: false
      responses:
        "201":
          description: Reply created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: Reply ID
                  author:
                    type: string
                    description: Author name
                  content:
                    type: string
                    description: Reply content
                  createdAt:
                    type: string
                    description: Creation timestamp
                required:
                  - id
                  - author
                  - content
                  - createdAt
        "404":
          description: Annotation not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
        "500":
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
  /api/changesets:
    get:
      tags:
        - Changesets
      summary: Get changesets
      description: Retrieve a list of all changesets
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Changesets retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                  changesets:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        name:
                          type: string
                        status:
                          type: string
                          enum:
                            - active
                            - applied
                            - abandoned
                        type:
                          type: string
                          enum:
                            - feature
                            - bugfix
                            - exploration
                        created_at:
                          type: string
                        elements_count:
                          type: number
                      required:
                        - name
                        - status
                        - type
                        - created_at
                        - elements_count
                required:
                  - version
                  - changesets
  /api/changesets/:changesetId:
    get:
      tags:
        - Changesets
      summary: Get changeset
      description: Retrieve a specific changeset with all its changes
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            minLength: 1
            pattern: ^[a-z0-9_-]+$
          required: true
          name: changesetId
          in: path
      responses:
        "200":
          description: Changeset retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  metadata:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      description:
                        type: string
                      type:
                        type: string
                        enum:
                          - feature
                          - bugfix
                          - exploration
                      status:
                        type: string
                        enum:
                          - active
                          - applied
                          - abandoned
                      created_at:
                        type: string
                      updated_at:
                        type: string
                      workflow:
                        type: string
                      summary:
                        type: object
                        properties:
                          elements_added:
                            type: number
                          elements_updated:
                            type: number
                          elements_deleted:
                            type: number
                        required:
                          - elements_added
                          - elements_updated
                          - elements_deleted
                    required:
                      - id
                      - name
                      - type
                      - status
                      - created_at
                      - summary
                  changes:
                    type: object
                    properties:
                      version:
                        type: string
                      changes:
                        type: array
                        items:
                          type: object
                          properties:
                            timestamp:
                              type: string
                            operation:
                              type: string
                              enum:
                                - add
                                - update
                                - delete
                            element_id:
                              type: string
                            layer:
                              type: string
                            element_type:
                              type: string
                            data:
                              description: Element data (varies by element type)
                            before:
                              description: Previous element state (for update operations)
                            after:
                              description: New element state (for update operations)
                          required:
                            - timestamp
                            - operation
                            - element_id
                            - layer
                            - element_type
                    required:
                      - version
                      - changes
                required:
                  - metadata
                  - changes
        "404":
          description: Changeset not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message
                required:
                  - error
webhooks: {}
