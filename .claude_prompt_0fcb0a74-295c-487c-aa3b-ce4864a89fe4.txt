
You are a Senior Software Engineer.

I implement clean, well thought out code with proper error handling and maintainable architecture.

**Issue Title**: Phase 2.1: Migrate 10 motivation layer nodes to UnifiedNode

**Description**:
Migrate all motivation layer nodes (Goal, Assessment, Driver, Outcome, Principle, Constraint, Meaning, Value, Stakeholder, Requirement) to use the UnifiedNode component. Update nodeTransformer to return unified node type and normalized data shape. Update Storybook stories and verify visual parity before deleting original implementations.

## Requirements
- **FR-5.1**: Update `getNodeTypeForElement()` in `nodeTransformer.ts` to use JSON configuration lookup instead of hardcoded switch statement
- **FR-7.1**: All node data interfaces must be normalized to a consistent structure that includes `nodeType`, `label`, `items`, `hideFields`, `badges`, `detailLevel`, `changesetOperation`
- **FR-7.2**: The `extractNodeData()` function must be updated to return the normalized structure regardless of source node type
- **FR-8.2**: All Storybook stories must be updated to use the unified component
- **FR-8.4**: E2E tests must validate that existing model YAML files render correctly (node counts, connectivity, visual appearance)

## Design Guidance
**nodeTransformer.ts Updates**:
```typescript
import { nodeConfigLoader } from '@/core/nodes/nodeConfigLoader';
import { NodeType } from '@/core/nodes/NodeType';
import type { UnifiedNodeData } from '@/core/nodes/UnifiedNode';

// Update getNodeTypeForElement() for motivation layer
export function getNodeTypeForElement(element: ModelElement): string {
  // For motivation layer elements
  if (element.layer === 'motivation') {
    const mappedType = nodeConfigLoader.mapElementType(element.type);
    if (mappedType && mappedType.startsWith('motivation.')) {
      return 'unified'; // Return unified node type for React Flow
    }
  }
  
  // ... existing logic for other layers
}

// Update extractNodeData() for motivation layer
export function extractNodeData(element: ModelElement): UnifiedNodeData {
  const mappedType = nodeConfigLoader.mapElementType(element.type);
  
  if (mappedType && mappedType.startsWith('motivation.')) {
    return {
      nodeType: mappedType as NodeType,
      label: element.name || element.label || element.id,
      items: extractFieldItems(element), // Extract from element attributes
      badges: extractBadges(element),
      detailLevel: element.detailLevel || 'standard',
      changesetOperation: element.changesetOperation,
      relationshipBadge: element.relationshipBadge,
    };
  }
  
  // ... existing logic for other layers
}

// Helper: Extract field items from element attributes
function extractFieldItems(element: ModelElement): FieldItem[] | undefined {
  if (!element.attributes) return undefined;
  
  return Object.entries(element.attributes).map(([key, value]) => ({
    id: key,
    label: formatFieldLabel(key),
    value: String(value),
    required: false, // Determine from schema if available
  }));
}

// Helper: Format field labels (camelCase â†’ Title Case)
function formatFieldLabel(key: string): string {
  return key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
}
```

**Storybook Migration Pattern**:
For each motivation node story (e.g., `GoalNode.stories.tsx`):

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import UnifiedNode from '@/core/nodes/UnifiedNode';
import { NodeType } from '@/core/nodes/NodeType';
import { ReactFlowDecorator } from '@catalog/decorators/ReactFlowDecorator';

const meta: Meta<typeof UnifiedNode> = {
  title: 'Nodes/Motivation/Goal',
  component: UnifiedNode,
  decorators: [ReactFlowDecorator],
  tags: ['autodocs'],
};

export default meta;
type Story = StoryObj<typeof UnifiedNode>;

export const Default: Story = {
  args: {
    id: 'goal-1',
    data: {
      nodeType: NodeType.MOTIVATION_GOAL,
      label: 'Increase Customer Satisfaction',
      items: [
        { id: 'description', label: 'Description', value: 'Improve NPS score by 20 points' },
        { id: 'priority', label: 'Priority', value: 'High', required: true },
      ],
      badges: [
        { position: 'top-right', content: 'ðŸŽ¯', ariaLabel: 'Primary goal' }
      ],
    },
  },
};

export const WithChangeset: Story = {
  args: {
    ...Default.args,
    data: {
      ...Default.args.data,
      changesetOperation: 'add',
    },
  },
};

export const MinimalZoom: Story = {
  args: {
    ...Default.args,
    data: {
      ...Default.args.data,
      detailLevel: 'minimal',
    },
  },
};
```

**Migration Checklist for Each Node**:
1. Verify JSON config entry exists for NodeType (from Phase 1.1)
2. Update `getNodeTypeForElement()` to return 'unified' for this type
3. Update `extractNodeData()` to return UnifiedNodeData shape
4. Update Storybook stories to use UnifiedNode with NodeType
5. Run Storybook validation: `npm run test:storybook`
6. Run E2E tests: `npm test` (check motivation layer tests)
7. Visual comparison: Compare Storybook story screenshots before/after
8. Delete original node component file after verification

**Motivation Layer Nodes to Migrate** (10 total):
1. `StakeholderNode.tsx` â†’ `NodeType.MOTIVATION_STAKEHOLDER`
2. `GoalNode.tsx` â†’ `NodeType.MOTIVATION_GOAL`
3. `RequirementNode.tsx` â†’ `NodeType.MOTIVATION_REQUIREMENT`
4. `AssessmentNode.tsx` â†’ `NodeType.MOTIVATION_ASSESSMENT`
5. `DriverNode.tsx` â†’ `NodeType.MOTIVATION_DRIVER`
6. `OutcomeNode.tsx` â†’ `NodeType.MOTIVATION_OUTCOME`
7. `PrincipleNode.tsx` â†’ `NodeType.MOTIVATION_PRINCIPLE`
8. `ConstraintNode.tsx` â†’ `NodeType.MOTIVATION_CONSTRAINT`
9. `MeaningNode.tsx` â†’ `NodeType.MOTIVATION_MEANING`
10. `ValueNode.tsx` â†’ `NodeType.MOTIVATION_VALUE`

**Implementation Notes**:
- Migrate nodes one at a time, running tests after each
- Preserve RelationshipBadge.tsx (moved to components/ in Phase 1.2)
- Extract field items from element attributes (all motivation nodes have attributes)
- All motivation nodes use 'centered' layout per existing pattern
- Verify handle IDs remain consistent (edges must connect correctly)
- Run E2E tests with existing YAML models to verify rendering

## Acceptance Criteria
- [ ] `getNodeTypeForElement()` updated to return 'unified' for all motivation layer types
- [ ] `extractNodeData()` updated to return UnifiedNodeData for all motivation layer types
- [ ] `extractFieldItems()` helper function created
- [ ] All 10 motivation node Storybook stories updated to use UnifiedNode
- [ ] Storybook validation passes for all motivation stories
- [ ] Visual comparison confirms parity with original implementations
- [ ] E2E tests pass with existing motivation layer YAML models
- [ ] Node counts match expected values in E2E tests
- [ ] Edge connectivity preserved (handles connect correctly)
- [ ] All 10 original motivation node files deleted
- [ ] `src/core/nodes/motivation/` directory deleted (except RelationshipBadge if not moved)
- [ ] Code is reviewed and approved

## Dependencies
Phase 1.4

## Parent Issue
Part of #341

## Discussion
This work is detailed in discussion [342](https://github.com/tinkermonkey/documentation_robotics_viewer/discussions/342)

---



