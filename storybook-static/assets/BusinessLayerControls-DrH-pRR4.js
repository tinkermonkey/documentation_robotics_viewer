import{r as N,j as n}from"./iframe-DSSgKmXl.js";import"./BaseInspectorPanel-BBWNLuHC.js";import{B as E}from"./BaseControlPanel-D-ZWsrS_.js";import"./GraphViewSidebar-BmDrn4TD.js";import"./NavigationErrorNotification-BQSize9i.js";import{c as D}from"./react-fqQoFC2C.js";import{L as j}from"./Label-BgBB6PcL.js";import{B as w}from"./Button-DjdbHWkm.js";import{D as I}from"./download-GiEPQcXk.js";import{c as _}from"./createLucideIcon-CIvKt9yE.js";import{C}from"./Card-dBO4-pIe.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],F=_("file-text",$);function O(s,e){let t;try{t=s()}catch{return}return{getItem:o=>{var a;const m=x=>x===null?null:JSON.parse(x,void 0),p=(a=t.getItem(o))!=null?a:null;return p instanceof Promise?p.then(m):m(p)},setItem:(o,a)=>t.setItem(o,JSON.stringify(a,void 0)),removeItem:o=>t.removeItem(o)}}const T=s=>e=>{try{const t=s(e);return t instanceof Promise?t:{then(i){return T(i)(t)},catch(i){return this}}}catch(t){return{then(i){return this},catch(i){return T(i)(t)}}}},R=(s,e)=>(t,i,o)=>{let a={storage:O(()=>window.localStorage),partialize:c=>c,version:0,merge:(c,v)=>({...v,...c}),...e},m=!1,p=0;const x=new Set,b=new Set;let l=a.storage;if(!l)return s((...c)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),t(...c)},i,o);const u=()=>{const c=a.partialize({...i()});return l.setItem(a.name,{state:c,version:a.version})},y=o.setState;o.setState=(c,v)=>(y(c,v),u());const d=s((...c)=>(t(...c),u()),i,o);o.getInitialState=()=>d;let S;const B=()=>{var c,v;if(!l)return;const L=++p;m=!1,x.forEach(f=>{var r;return f((r=i())!=null?r:d)});const k=((v=a.onRehydrateStorage)==null?void 0:v.call(a,(c=i())!=null?c:d))||void 0;return T(l.getItem.bind(l))(a.name).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==a.version){if(a.migrate){const r=a.migrate(f.state,f.version);return r instanceof Promise?r.then(g=>[!0,g]):[!0,r]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,f.state];return[!1,void 0]}).then(f=>{var r;if(L!==p)return;const[g,h]=f;if(S=a.merge(h,(r=i())!=null?r:d),t(S,!0),g)return u()}).then(()=>{L===p&&(k==null||k(S,void 0),S=i(),m=!0,b.forEach(f=>f(S)))}).catch(f=>{L===p&&(k==null||k(void 0,f))})};return o.persist={setOptions:c=>{a={...a,...c},c.storage&&(l=c.storage)},clearStorage:()=>{l==null||l.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>B(),hasHydrated:()=>m,onHydrate:c=>(x.add(c),()=>{x.delete(c)}),onFinishHydration:c=>(b.add(c),()=>{b.delete(c)})},a.skipHydration||B(),S||d},H=R,q={types:new Set,domains:new Set,lifecycles:new Set,criticalities:new Set},A={selectedLayout:"hierarchical",filters:q,expandedNodes:new Set,manualPositions:new Map,focusMode:"none",focusRadius:2,selectedNodeId:void 0},J=s=>typeof s=="string"&&["hierarchical","swimlane","matrix","force","manual"].includes(s),U=s=>typeof s=="string"&&["none","selected","radial","upstream","downstream"].includes(s),M=s=>typeof s=="string"&&s.length>0&&s.length<=1e3,Y=s=>typeof s=="number"&&s>=1&&s<=10&&Number.isInteger(s),Q=D()(H(s=>({...A,setSelectedLayout:e=>{if(!J(e)){console.error(`[BusinessLayerStore] Invalid layout: ${e}`);return}s({selectedLayout:e})},setFilters:e=>{if(!e||typeof e!="object"){console.error("[BusinessLayerStore] Invalid filters: must be an object");return}if(e.types!==void 0&&!(e.types instanceof Set)){console.error("[BusinessLayerStore] Filter types must be a Set");return}if(e.domains!==void 0&&!(e.domains instanceof Set)){console.error("[BusinessLayerStore] Filter domains must be a Set");return}if(e.lifecycles!==void 0&&!(e.lifecycles instanceof Set)){console.error("[BusinessLayerStore] Filter lifecycles must be a Set");return}if(e.criticalities!==void 0&&!(e.criticalities instanceof Set)){console.error("[BusinessLayerStore] Filter criticalities must be a Set");return}s({filters:e})},clearFilters:()=>{s({filters:{types:new Set,domains:new Set,lifecycles:new Set,criticalities:new Set}})},toggleTypeFilter:e=>{if(typeof e!="string"||e.length===0){console.error("[BusinessLayerStore] Invalid type filter value");return}s(t=>{const i=new Set(t.filters.types);return i.has(e)?i.delete(e):i.add(e),{filters:{...t.filters,types:i}}})},toggleDomainFilter:e=>{if(typeof e!="string"||e.length===0){console.error("[BusinessLayerStore] Invalid domain filter value");return}s(t=>{const i=new Set(t.filters.domains);return i.has(e)?i.delete(e):i.add(e),{filters:{...t.filters,domains:i}}})},toggleLifecycleFilter:e=>{if(typeof e!="string"||!["ideation","active","deprecated"].includes(e)){console.error("[BusinessLayerStore] Invalid lifecycle filter value");return}s(i=>{const o=new Set(i.filters.lifecycles);return o.has(e)?o.delete(e):o.add(e),{filters:{...i.filters,lifecycles:o}}})},toggleCriticalityFilter:e=>{if(typeof e!="string"||!["high","medium","low"].includes(e)){console.error("[BusinessLayerStore] Invalid criticality filter value");return}s(i=>{const o=new Set(i.filters.criticalities);return o.has(e)?o.delete(e):o.add(e),{filters:{...i.filters,criticalities:o}}})},toggleNodeExpanded:e=>{if(!M(e)){console.error("[BusinessLayerStore] Invalid node ID for toggle expanded");return}s(t=>{const i=new Set(t.expandedNodes);return i.has(e)?i.delete(e):i.add(e),{expandedNodes:i}})},setManualPosition:(e,t)=>{if(!M(e)){console.error("[BusinessLayerStore] Invalid node ID for manual position");return}if(!t||typeof t!="object"||typeof t.x!="number"||typeof t.y!="number"){console.error("[BusinessLayerStore] Invalid position object");return}s(i=>{const o=new Map(i.manualPositions);return o.set(e,t),{manualPositions:o}})},setManualPositions:e=>{if(!(e instanceof Map)){console.error("[BusinessLayerStore] Manual positions must be a Map");return}s({manualPositions:e})},setFocusMode:e=>{if(!U(e)){console.error(`[BusinessLayerStore] Invalid focus mode: ${e}`);return}s({focusMode:e})},setFocusRadius:e=>{if(!Y(e)){console.error(`[BusinessLayerStore] Invalid focus radius: ${e}`);return}s({focusRadius:e})},setSelectedNodeId:e=>{if(e!==void 0&&!M(e)){console.error("[BusinessLayerStore] Invalid selected node ID");return}s({selectedNodeId:e})},reset:()=>{s(A)}}),{name:"business-layer-preferences",version:1,storage:{getItem:s=>{if(typeof window>"u"||typeof localStorage>"u")return null;try{const e=localStorage.getItem(s);if(!e)return null;const{state:t}=JSON.parse(e);return t.filters&&(Array.isArray(t.filters.types)?t.filters.types=new Set(t.filters.types):t.filters.types=new Set,Array.isArray(t.filters.domains)?t.filters.domains=new Set(t.filters.domains):t.filters.domains=new Set,Array.isArray(t.filters.lifecycles)?t.filters.lifecycles=new Set(t.filters.lifecycles):t.filters.lifecycles=new Set,Array.isArray(t.filters.criticalities)?t.filters.criticalities=new Set(t.filters.criticalities):t.filters.criticalities=new Set),Array.isArray(t.expandedNodes)?t.expandedNodes=new Set(t.expandedNodes):t.expandedNodes=new Set,t.manualPositions&&typeof t.manualPositions=="object"?t.manualPositions=new Map(Object.entries(t.manualPositions)):t.manualPositions=new Map,{state:t}}catch(e){return console.error("[BusinessLayerStore] Error reading from localStorage:",e),null}},setItem:(s,e)=>{var t,i,o,a;if(!(typeof window>"u"||typeof localStorage>"u"))try{const m=JSON.stringify({state:{...e.state,filters:{types:Array.from(((t=e.state.filters)==null?void 0:t.types)||[]),domains:Array.from(((i=e.state.filters)==null?void 0:i.domains)||[]),lifecycles:Array.from(((o=e.state.filters)==null?void 0:o.lifecycles)||[]),criticalities:Array.from(((a=e.state.filters)==null?void 0:a.criticalities)||[])},expandedNodes:Array.from(e.state.expandedNodes||[]),manualPositions:e.state.manualPositions?Object.fromEntries(e.state.manualPositions):{}}});localStorage.setItem(s,m)}catch(m){m instanceof Error&&m.name==="QuotaExceededError"?console.error("[BusinessLayerStore] localStorage quota exceeded. Unable to save preferences."):console.error("[BusinessLayerStore] Error writing to localStorage:",m)}},removeItem:s=>{if(!(typeof window>"u"||typeof localStorage>"u"))try{localStorage.removeItem(s)}catch(e){console.error("[BusinessLayerStore] Error removing from localStorage:",e)}}}}));function ce(s,e,t,i){return N.useMemo(()=>{if(!i)return{filteredNodes:s,filteredEdges:e,visibleCount:s.length,totalCount:s.length};const o=performance.now();let a=new Set(i.nodes.keys());if(t.types.size>0){const l=new Set;for(const u of t.types){const y=i.indices.byType.get(u);y&&y.forEach(d=>l.add(d))}a=new Set([...a].filter(u=>l.has(u)))}if(t.domains.size>0){const l=new Set;for(const u of t.domains){const y=i.indices.byDomain.get(u);y&&y.forEach(d=>l.add(d))}a=new Set([...a].filter(u=>l.has(u)))}if(t.lifecycles.size>0){const l=new Set;for(const u of t.lifecycles){const y=i.indices.byLifecycle.get(u);y&&y.forEach(d=>l.add(d))}a=new Set([...a].filter(u=>l.has(u)))}if(t.criticalities.size>0){const l=new Set;for(const u of t.criticalities){const y=i.indices.byCriticality.get(u);y&&y.forEach(d=>l.add(d))}a=new Set([...a].filter(u=>l.has(u)))}const m=s.filter(l=>a.has(l.id)),p=e.filter(l=>a.has(l.source)&&a.has(l.target)),b=performance.now()-o;return b>500&&console.warn(`[useBusinessFilters] Filter operation took ${b.toFixed(2)}ms (target: <500ms)`),{filteredNodes:m,filteredEdges:p,visibleCount:m.length,totalCount:s.length}},[s,e,t,i])}function W(s){return N.useMemo(()=>s?{types:Array.from(s.indices.byType.keys()),domains:Array.from(s.indices.byDomain.keys()),lifecycles:Array.from(s.indices.byLifecycle.keys()),criticalities:Array.from(s.indices.byCriticality.keys())}:{types:[],domains:[],lifecycles:[],criticalities:[]},[s])}const K={function:"Functions",process:"Processes",service:"Services",capability:"Capabilities"},X=[{value:"hierarchical",label:"Hierarchical",description:"Top-down tree structure for business functions"},{value:"swimlane",label:"Swimlane",description:"Swimlane layout organized by domain"},{value:"matrix",label:"Matrix",description:"Matrix layout showing relationships"},{value:"force",label:"Force-Directed",description:"Network layout using physics simulation"},{value:"manual",label:"Manual",description:"Preserve user-adjusted node positions"}];function P({businessGraph:s,onExport:e,isExporting:t,visibleCount:i,totalCount:o}){const{filters:a,selectedLayout:m,setSelectedLayout:p,toggleTypeFilter:x,toggleDomainFilter:b,toggleLifecycleFilter:l,toggleCriticalityFilter:u,clearFilters:y}=Q(),d=W(s),S=N.useMemo(()=>{var r,g,h,z;return s?{function:((r=s.indices.byType.get("function"))==null?void 0:r.size)||0,process:((g=s.indices.byType.get("process"))==null?void 0:g.size)||0,service:((h=s.indices.byType.get("service"))==null?void 0:h.size)||0,capability:((z=s.indices.byType.get("capability"))==null?void 0:z.size)||0}:{function:0,process:0,service:0,capability:0}},[s]),B=N.useMemo(()=>{if(!s)return{};const r={};return s.indices.byDomain.forEach((g,h)=>{r[h]=g.size}),r},[s]),c=N.useMemo(()=>{if(!s)return{};const r={};return s.indices.byLifecycle.forEach((g,h)=>{r[h]=g.size}),r},[s]),v=N.useMemo(()=>{if(!s)return{};const r={};return s.indices.byCriticality.forEach((g,h)=>{r[h]=g.size}),r},[s]),L=a.types.size>0||a.domains.size>0||a.lifecycles.size>0||a.criticalities.size>0,k=()=>n.jsxs("div",{className:"space-y-4","data-testid":"business-filters-section",children:[n.jsxs(C,{className:"dark:bg-gray-800 dark:border-gray-700","data-testid":"business-element-count",children:[n.jsx(j,{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Elements"}),n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Showing ",i," of ",o]})]}),d.types.length>0&&n.jsxs(C,{className:"dark:bg-gray-800 dark:border-gray-700","data-testid":"business-type-filters",children:[n.jsx(j,{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Element Types"}),n.jsx("div",{className:"space-y-2",children:d.types.map(r=>n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer","data-testid":`business-type-filter-${r}`,children:[n.jsx("input",{type:"checkbox",checked:a.types.has(r),onChange:()=>x(r),className:"rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700","data-testid":`business-type-checkbox-${r}`}),n.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[K[r]," (",S[r],")"]})]},r))})]}),d.domains.length>0&&n.jsxs(C,{className:"dark:bg-gray-800 dark:border-gray-700","data-testid":"business-domain-filters",children:[n.jsx(j,{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Business Domains"}),n.jsx("div",{className:"space-y-2",children:d.domains.map(r=>n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer","data-testid":`business-domain-filter-${r}`,children:[n.jsx("input",{type:"checkbox",checked:a.domains.has(r),onChange:()=>b(r),className:"rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700","data-testid":`business-domain-checkbox-${r}`}),n.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[r," (",B[r]||0,")"]})]},r))})]}),d.lifecycles.length>0&&n.jsxs(C,{className:"dark:bg-gray-800 dark:border-gray-700","data-testid":"business-lifecycle-filters",children:[n.jsx(j,{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Lifecycle Stage"}),n.jsx("div",{className:"space-y-2",children:d.lifecycles.map(r=>n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer","data-testid":`business-lifecycle-filter-${r}`,children:[n.jsx("input",{type:"checkbox",checked:a.lifecycles.has(r),onChange:()=>l(r),className:"rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700","data-testid":`business-lifecycle-checkbox-${r}`}),n.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300 capitalize",children:[r," (",c[r]||0,")"]})]},r))})]}),d.criticalities.length>0&&n.jsxs(C,{className:"dark:bg-gray-800 dark:border-gray-700","data-testid":"business-criticality-filters",children:[n.jsx(j,{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Criticality"}),n.jsx("div",{className:"space-y-2",children:d.criticalities.map(r=>n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer","data-testid":`business-criticality-filter-${r}`,children:[n.jsx("input",{type:"checkbox",checked:a.criticalities.has(r),onChange:()=>u(r),className:"rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700","data-testid":`business-criticality-checkbox-${r}`}),n.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300 capitalize",children:[r," (",v[r]||0,")"]})]},r))})]}),L&&n.jsx(w,{color:"red",onClick:y,size:"sm",className:"w-full","data-testid":"business-clear-filters-button",children:"Clear All Filters"})]},"filters"),f=()=>e?n.jsxs("div",{className:"control-panel-section export-section","data-testid":"business-export-section",children:[n.jsx(j,{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"Export"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs(w,{color:"gray",onClick:()=>e("png"),disabled:t,size:"sm",title:"Export as PNG","data-testid":"business-export-png",children:[n.jsx(I,{className:"mr-2 h-4 w-4"}),"PNG"]}),n.jsxs(w,{color:"gray",onClick:()=>e("svg"),disabled:t,size:"sm",title:"Export as SVG","data-testid":"business-export-svg",children:[n.jsx(I,{className:"mr-2 h-4 w-4"}),"SVG"]}),n.jsxs(w,{color:"gray",onClick:()=>e("graphData"),disabled:t,size:"sm",title:"Export Graph Data","data-testid":"business-export-data",children:[n.jsx(I,{className:"mr-2 h-4 w-4"}),"Data"]}),n.jsxs(w,{color:"gray",onClick:()=>e("catalog"),disabled:t,size:"sm",title:"Export Process Catalog","data-testid":"business-export-catalog",children:[n.jsx(F,{className:"mr-2 h-4 w-4"}),"Catalog"]}),n.jsxs(w,{color:"gray",onClick:()=>e("traceability"),disabled:t,size:"sm",title:"Export Traceability Report","data-testid":"business-export-report",children:[n.jsx(F,{className:"mr-2 h-4 w-4"}),"Report"]}),n.jsxs(w,{color:"gray",onClick:()=>e("impact"),disabled:t,size:"sm",title:"Export Impact Analysis","data-testid":"business-export-impact",children:[n.jsx(F,{className:"mr-2 h-4 w-4"}),"Impact"]})]})]},"exports"):null;return n.jsx("div",{className:"business-layer-controls",children:n.jsx(E,{selectedLayout:m,onLayoutChange:r=>p(r),layoutOptions:X,onFitToView:()=>{},isLayouting:t,renderBeforeLayout:k,renderControls:f,testId:"business-control-panel"})})}const Z=N.memo(P);Z.displayName="BusinessLayerControls";P.__docgenInfo={description:"Business Layer Controls Component",methods:[],displayName:"BusinessLayerControlsComponent",props:{businessGraph:{required:!0,tsType:{name:"union",raw:"BusinessGraph | null",elements:[{name:"BusinessGraph"},{name:"null"}]},description:"Business graph with indices"},onExport:{required:!0,tsType:{name:"signature",type:"function",raw:"(type: 'png' | 'svg' | 'graphData' | 'catalog' | 'traceability' | 'impact') => void",signature:{arguments:[{type:{name:"union",raw:"'png' | 'svg' | 'graphData' | 'catalog' | 'traceability' | 'impact'",elements:[{name:"literal",value:"'png'"},{name:"literal",value:"'svg'"},{name:"literal",value:"'graphData'"},{name:"literal",value:"'catalog'"},{name:"literal",value:"'traceability'"},{name:"literal",value:"'impact'"}]},name:"type"}],return:{name:"void"}}},description:"Export callback"},isExporting:{required:!0,tsType:{name:"boolean"},description:"Whether an export operation is in progress"},visibleCount:{required:!0,tsType:{name:"number"},description:"Visible node count after filtering"},totalCount:{required:!0,tsType:{name:"number"},description:"Total node count"}}};export{Z as B,ce as a,Q as u};
