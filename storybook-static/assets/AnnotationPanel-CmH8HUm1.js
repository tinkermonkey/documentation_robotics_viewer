import{r as d,j as e}from"./iframe-DSSgKmXl.js";import{u as ge}from"./annotationStore-C2enqPKJ.js";import{u as ue}from"./modelStore-D8PMC_DL.js";import{E as he}from"./EmptyState-B6ktL3oV.js";import{L as xe}from"./LoadingState-DZmQgDQh.js";import{E as fe}from"./ErrorState-uaa9-pX2.js";import"./BreadcrumbNav-DXCKxi7g.js";import"./FilterPanel-C0Vy-Tax.js";import"./ExportButtonGroup-C-LUBG8s.js";import"./LayerRightSidebar-BAszuvNY.js";import{l as L,E as D}from"./errorTracker-DrR4A8t3.js";import{B as A}from"./Button-DjdbHWkm.js";import{c as U}from"./createLucideIcon-CIvKt9yE.js";import{u as pe,p as ye,d as be,h as ve,i as we,c as je,q as ke,r as Ne,F as Ce}from"./floating-ui.react-CidLzX28.js";import{c as q,u as V,a as W,g as S,r as Y,t as f}from"./create-theme-BOkxhGns.js";import{L as ae}from"./Label-BgBB6PcL.js";import{B as oe}from"./Badge-4uEMzFcW.js";const Te=q({root:{base:"flex items-center justify-center space-x-4 rounded",inner:"relative",bordered:"p-1 ring-2",rounded:"rounded-full",color:{dark:"ring-gray-800 dark:ring-gray-800",failure:"ring-red-500 dark:ring-red-700",gray:"ring-gray-500 dark:ring-gray-400",info:"ring-cyan-400 dark:ring-cyan-800",light:"ring-gray-300 dark:ring-gray-500",purple:"ring-purple-500 dark:ring-purple-600",success:"ring-green-500 dark:ring-green-500",warning:"ring-yellow-300 dark:ring-yellow-500",pink:"ring-pink-500 dark:ring-pink-500"},img:{base:"rounded",off:"relative overflow-hidden bg-gray-100 dark:bg-gray-600",on:"",placeholder:"absolute -bottom-1 h-auto w-auto text-gray-400"},size:{xs:"h-6 w-6",sm:"h-8 w-8",md:"h-10 w-10",lg:"h-20 w-20",xl:"h-36 w-36"},stacked:"ring-2 ring-gray-300 dark:ring-gray-500",statusPosition:{"bottom-left":"-bottom-1 -left-1","bottom-center":"-bottom-1","bottom-right":"-bottom-1 -right-1","top-left":"-left-1 -top-1","top-center":"-top-1","top-right":"-right-1 -top-1","center-right":"-right-1",center:"","center-left":"-left-1"},status:{away:"bg-yellow-400",base:"absolute h-3.5 w-3.5 rounded-full border-2 border-white dark:border-gray-800",busy:"bg-red-400",offline:"bg-gray-400",online:"bg-green-400"},initials:{text:"font-medium text-gray-600 dark:text-gray-300",base:"relative inline-flex items-center justify-center overflow-hidden bg-gray-100 dark:bg-gray-600"}},group:{base:"flex -space-x-4"},groupCounter:{base:"relative flex h-10 w-10 items-center justify-center rounded-full bg-gray-700 text-xs font-medium text-white ring-2 ring-gray-300 hover:bg-gray-600 dark:ring-gray-500"}}),B=d.forwardRef((a,l)=>{var p,j;const o=V(),s=W([Te,(p=o.theme)==null?void 0:p.avatar,a.theme],[S(o.clearTheme,"avatar"),a.clearTheme],[S(o.applyTheme,"avatar"),a.applyTheme]),{alt:n="",bordered:i=!1,children:y,className:k,color:u="light",img:c,placeholderInitials:R="",rounded:E=!1,size:N="md",stacked:g=!1,status:b,statusPosition:v="top-left",...w}=Y(a,(j=o.props)==null?void 0:j.avatar),h=f(s.root.img.base,i&&s.root.bordered,i&&s.root.color[u],E&&s.root.rounded,g&&s.root.stacked,s.root.img.on,s.root.size[N]),C={className:f(h,s.root.img.on),"data-testid":"flowbite-avatar-img"};return e.jsxs("div",{ref:l,className:f(s.root.base,k),"data-testid":"flowbite-avatar",...w,children:[e.jsxs("div",{className:s.root.inner,children:[c?typeof c=="string"?e.jsx("img",{alt:n,src:c,...C}):c({alt:n,...C}):R?e.jsx("div",{className:f(s.root.img.off,s.root.initials.base,g&&s.root.stacked,i&&s.root.bordered,i&&s.root.color[u],s.root.size[N],E&&s.root.rounded),"data-testid":"flowbite-avatar-initials-placeholder",children:e.jsx("span",{className:f(s.root.initials.text),"data-testid":"flowbite-avatar-initials-placeholder-text",children:R})}):e.jsx("div",{className:f(h,s.root.img.off),"data-testid":"flowbite-avatar-img",children:e.jsx("svg",{className:s.root.img.placeholder,fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),b&&e.jsx("span",{"data-testid":"flowbite-avatar-status",className:f(s.root.status.base,s.root.status[b],s.root.statusPosition[v])})]}),y&&e.jsx("div",{children:y})]})});B.displayName="Avatar";const Ae=d.createContext(void 0),Re=q({root:{base:"fixed inset-x-0 top-0 z-50 h-screen overflow-y-auto overflow-x-hidden md:inset-0 md:h-full",show:{on:"flex bg-gray-900/50 dark:bg-gray-900/80",off:"hidden"},sizes:{sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl","3xl":"max-w-3xl","4xl":"max-w-4xl","5xl":"max-w-5xl","6xl":"max-w-6xl","7xl":"max-w-7xl"},positions:{"top-left":"items-start justify-start","top-center":"items-start justify-center","top-right":"items-start justify-end","center-left":"items-center justify-start",center:"items-center justify-center","center-right":"items-center justify-end","bottom-right":"items-end justify-end","bottom-center":"items-end justify-center","bottom-left":"items-end justify-start"}},content:{base:"relative h-full w-full p-4 md:h-auto",inner:"relative flex max-h-[90dvh] flex-col rounded-lg bg-white shadow dark:bg-gray-700"},body:{base:"flex-1 overflow-auto p-6",popup:"pt-0"},header:{base:"flex items-start justify-between rounded-t border-b p-5 dark:border-gray-600",popup:"border-b-0 p-2",title:"text-xl font-medium text-gray-900 dark:text-white",close:{base:"ms-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900 dark:hover:bg-gray-600 dark:hover:text-white",icon:"h-5 w-5"}},footer:{base:"flex items-center gap-2 rounded-b border-gray-200 p-6 dark:border-gray-600",popup:"border-t"}}),ne=d.forwardRef((a,l)=>{var x,F;const[o,s]=d.useState(void 0),n=V(),i=W([Re,(x=n.theme)==null?void 0:x.modal,a.theme],[S(n.clearTheme,"modal"),a.clearTheme],[S(n.applyTheme,"modal"),a.applyTheme]),{children:y,className:k,dismissible:u=!1,onClose:c,popup:R,position:E="center",root:N,show:g,size:b="2xl",initialFocus:v,...w}=Y(a,(F=n.props)==null?void 0:F.modal),{context:h}=pe({open:g,onOpenChange:()=>c&&c()}),C=ye([h.refs.setFloating,l]),p=be(h),j=ve(h,{outsidePressEvent:"mousedown",enabled:u}),M=we(h),{getFloatingProps:z}=je([p,j,M]);return g?e.jsx(Ae.Provider,{value:{theme:a.theme,clearTheme:a.clearTheme,applyTheme:a.applyTheme,popup:R,dismissible:u,onClose:c,setHeaderId:s},children:e.jsx(ke,{root:N,children:e.jsx(Ne,{lockScroll:!0,"data-testid":"modal-overlay",className:f(i.root.base,i.root.positions[E],g?i.root.show.on:i.root.show.off,k),...w,children:e.jsx(Ce,{context:h,initialFocus:v,children:e.jsx("div",{ref:C,...z(w),"aria-labelledby":o,className:f(i.content.base,i.root.sizes[b]),children:e.jsx("div",{className:i.content.inner,children:y})})})})})}):null});ne.displayName="Modal";const Ee=q({base:"block w-full rounded-lg border p-2.5 text-sm focus:outline-none focus:ring-1 disabled:cursor-not-allowed disabled:opacity-50",colors:{gray:"border-gray-300 bg-gray-50 text-gray-900 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 dark:focus:border-primary-500 dark:focus:ring-primary-500",info:"border-cyan-500 bg-cyan-50 text-cyan-900 placeholder-cyan-700 focus:border-cyan-500 focus:ring-cyan-500 dark:border-cyan-400 dark:bg-cyan-100 dark:focus:border-cyan-500 dark:focus:ring-cyan-500",failure:"border-red-500 bg-red-50 text-red-900 placeholder-red-700 focus:border-red-500 focus:ring-red-500 dark:border-red-400 dark:bg-red-100 dark:focus:border-red-500 dark:focus:ring-red-500",warning:"border-yellow-500 bg-yellow-50 text-yellow-900 placeholder-yellow-700 focus:border-yellow-500 focus:ring-yellow-500 dark:border-yellow-400 dark:bg-yellow-100 dark:focus:border-yellow-500 dark:focus:ring-yellow-500",success:"border-green-500 bg-green-50 text-green-900 placeholder-green-700 focus:border-green-500 focus:ring-green-500 dark:border-green-400 dark:bg-green-100 dark:focus:border-green-500 dark:focus:ring-green-500"},withShadow:{on:"shadow-sm dark:shadow-sm-light",off:""}}),H=d.forwardRef((a,l)=>{var u,c;const o=V(),s=W([Ee,(u=o.theme)==null?void 0:u.textarea,a.theme],[S(o.clearTheme,"textarea"),a.clearTheme],[S(o.applyTheme,"textarea"),a.applyTheme]),{className:n,color:i="gray",shadow:y,...k}=Y(a,(c=o.props)==null?void 0:c.textarea);return e.jsx("textarea",{ref:l,className:f(s.base,s.colors[i],s.withShadow[y?"on":"off"],n),...k})});H.displayName="Textarea";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ie=U("check",Me);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ze=U("message-square",Se);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Pe=U("plus",Fe);function $e(a){if(!a)return[];const l=[],o=/@([\w.-]+)/g;let s=0,n;for(;(n=o.exec(a))!==null;)n.index>s&&l.push({type:"text",content:a.substring(s,n.index)}),l.push({type:"mention",content:n[0],elementId:n[1]}),s=n.index+n[0].length;return s<a.length&&l.push({type:"text",content:a.substring(s)}),l.length===0&&l.push({type:"text",content:a}),l}function Oe(a,l){var o;if(!l||!l.layers)return a;for(const s of Object.values(l.layers))if(s.elements){const n=s.elements.find(i=>i.id===a);if(n)return n.name||((o=n.properties)==null?void 0:o.name)||a}return a}const _e=({loadError:a=null})=>{const{annotations:l,selectedElementId:o,loading:s,error:n,createAnnotation:i,resolveAnnotation:y,unresolveAnnotation:k,createAnnotationReply:u,setHighlightedElementId:c}=ge(),{model:R}=ue(),[E,N]=d.useState(!1),[g,b]=d.useState(""),[v,w]=d.useState(""),[h,C]=d.useState(null),[p,j]=d.useState(""),[M,z]=d.useState(""),[x,F]=d.useState(null),P=d.useRef(null),$=d.useRef(null);d.useEffect(()=>()=>{P.current&&clearTimeout(P.current),$.current&&clearTimeout($.current)},[]);const T=(r,t)=>{F({type:r,message:t}),r==="success"&&(P.current&&clearTimeout(P.current),P.current=setTimeout(()=>F(null),3e3))},G=d.useMemo(()=>o?l.filter(r=>r.elementId===o):l,[l,o]),J=d.useMemo(()=>{if(o)return null;const r={};return l.forEach(t=>{r[t.elementId]||(r[t.elementId]=[]),r[t.elementId].push(t)}),r},[l,o]),K=r=>{const t=new Date(r),I=new Date().getTime()-t.getTime(),O=Math.floor(I/6e4),te=Math.floor(I/36e5),se=Math.floor(I/864e5);return O<1?"just now":O<60?`${O}m ago`:te<24?`${te}h ago`:se<7?`${se}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},Q=()=>{N(!0),b(""),w("")},_=()=>{N(!1),b(""),w("")},le=async()=>{if(!(!g.trim()||!v.trim()))try{await i(o||"global",g,v),_(),T("success","Comment added successfully")}catch(r){const t=r instanceof Error?r.message:"Failed to create annotation";L(D.ANNOTATION_CREATE_FAILED,t,{elementId:o},r instanceof Error?r:void 0),T("error",t)}},ie=async r=>{try{r.resolved?(await k(r.id),T("success","Annotation unresolved")):(await y(r.id),T("success","Annotation resolved"))}catch(t){const m=t instanceof Error?t.message:"Failed to toggle resolve status";L(D.ANNOTATION_RESOLVE_FAILED,m,{annotationId:r.id},t instanceof Error?t:void 0),T("error",m)}},de=r=>{C(r),j(""),z("")},X=()=>{C(null),j(""),z("")},ce=async r=>{if(!(!p.trim()||!M.trim()))try{await u(r,M,p),X(),T("success","Reply added successfully")}catch(t){const m=t instanceof Error?t.message:"Failed to create reply";L(D.ANNOTATION_REPLY_FAILED,m,{annotationId:r},t instanceof Error?t:void 0),T("error",m)}},me=r=>{console.log("[AnnotationPanel] Highlighting element:",r),c(r),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{c(null)},3e3)},Z=r=>{const t=r.trim().split(" ");return t.length>=2?`${t[0][0]}${t[t.length-1][0]}`.toUpperCase():r.substring(0,2).toUpperCase()},ee=r=>{const t=$e(r);return e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.map((m,I)=>{if(m.type==="mention"&&m.elementId){const O=Oe(m.elementId,R);return e.jsx(oe,{color:"info",size:"sm",className:"inline-flex items-center mx-0.5 cursor-pointer hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors",title:`Click to highlight: ${m.elementId}`,onClick:()=>me(m.elementId),children:O},I)}return e.jsx("span",{children:m.content},I)})})},re=r=>e.jsx("div",{className:"mb-3","data-testid":`annotation-${r.id}`,children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(B,{placeholderInitials:Z(r.author),rounded:!0,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.author}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:K(r.createdAt)}),r.resolved&&e.jsx(oe,{color:"success",size:"xs",children:"âœ“ Resolved"})]}),e.jsx("div",{className:"mb-2",children:ee(r.content)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(A,{size:"xs",color:r.resolved?"gray":"success",onClick:()=>ie(r),"data-testid":`resolve-btn-${r.id}`,children:[e.jsx(Ie,{className:"mr-1 h-3 w-3"}),r.resolved?"Unresolve":"Resolve"]}),e.jsxs(A,{size:"xs",color:"light",onClick:()=>de(r.id),"data-testid":`reply-btn-${r.id}`,children:[e.jsx(ze,{className:"mr-1 h-3 w-3"}),"Reply"]})]}),h===r.id&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg","data-testid":`reply-form-${r.id}`,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Your name",value:M,onChange:t=>z(t.target.value),className:"block w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 p-2 text-sm text-gray-900 dark:text-white focus:border-blue-500 focus:ring-blue-500"}),e.jsx(H,{placeholder:"Write your reply...",rows:2,value:p,onChange:t=>j(t.target.value),className:"text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{size:"xs",onClick:()=>ce(r.id),disabled:!p.trim()||!M.trim(),children:"Submit Reply"}),e.jsx(A,{size:"xs",color:"gray",onClick:X,children:"Cancel"})]})]})}),r.replies&&r.replies.length>0&&e.jsx("div",{className:"mt-3 pl-4 border-l-2 border-gray-200 dark:border-gray-700 space-y-3",children:r.replies.map(t=>e.jsxs("div",{className:"flex gap-2","data-testid":`reply-${t.id}`,children:[e.jsx(B,{placeholderInitials:Z(t.author),rounded:!0,size:"xs"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t.author}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:K(t.createdAt)})]}),e.jsx("div",{children:ee(t.content)})]})]},t.id))})]})]})},r.id);return s?e.jsx(xe,{variant:"panel",message:"Loading annotations..."}):a?e.jsx("div",{className:"p-4","data-testid":"annotation-load-error",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-red-600 dark:text-red-400 mb-1",children:"Failed to Load Annotations"}),e.jsx("div",{className:"text-xs text-red-700 dark:text-red-300",children:a})]})}):n?e.jsx(fe,{variant:"panel",message:n}):l.length===0?e.jsx("div",{className:"p-4",children:e.jsx(he,{variant:"annotations",action:{label:"Add Comment",onClick:Q}})}):e.jsxs("div",{className:"p-4","data-testid":"annotation-panel",children:[x&&e.jsx("div",{role:x.type==="error"?"alert":"status","aria-live":x.type==="error"?"assertive":"polite",className:`mb-4 p-3 rounded-lg ${x.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,"data-testid":`notification-${x.type}`,children:e.jsx("p",{className:`text-sm ${x.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:x.message})}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[o?"Element Annotations":"Comments"," (",G.length,")"]})}),e.jsxs(A,{color:"light",size:"sm",className:"w-full mb-4",onClick:Q,"data-testid":"add-comment-btn",children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Add Comment"]}),e.jsx(ne,{show:E,onClose:_,size:"md",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Add New Comment"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ae,{htmlFor:"author",children:"Your name"}),e.jsx("input",{id:"author",type:"text",placeholder:"Enter your name",value:v,onChange:r=>w(r.target.value),className:"block w-full mt-1 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 p-2.5 text-sm text-gray-900 dark:text-white focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(ae,{htmlFor:"comment",children:"Comment"}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[g.length," / 500"]})]}),e.jsx(H,{id:"comment",placeholder:"Write your comment here... Use @element.id to mention elements",rows:4,maxLength:500,value:g,onChange:r=>b(r.target.value)}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Tip: Use @element.id to reference specific elements"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(A,{onClick:le,disabled:!g.trim()||!v.trim(),children:"Add Comment"}),e.jsx(A,{color:"gray",onClick:_,children:"Cancel"})]})]})}),e.jsx("div",{className:"space-y-3",children:o?G.map(re):J&&Object.entries(J).map(([r,t])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:r}),t.map(re)]},r))})]})};_e.__docgenInfo={description:"",methods:[],displayName:"AnnotationPanel",props:{loadError:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"Error from annotation loading",defaultValue:{value:"null",computed:!1}}}};export{_e as A};
