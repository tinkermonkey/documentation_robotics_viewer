const L={JSONRPC_MESSAGE_PARSE_FAILED:"JSONRPC_001",JSONRPC_ATTACH_LISTENER_FAILED:"JSONRPC_002",JSONRPC_ATTACH_LISTENER_BACKGROUND_FAILED:"JSONRPC_003",JSONRPC_SEND_REQUEST_FAILED:"JSONRPC_004",JSONRPC_SEND_NOTIFICATION_FAILED:"JSONRPC_005",JSONRPC_NOTIFICATION_HANDLER_ERROR:"JSONRPC_006",JSONRPC_HANDLE_NOTIFICATION_ERROR:"JSONRPC_007",JSONRPC_MESSAGE_HANDLER_ERROR:"JSONRPC_008",JSONRPC_WEBSOCKET_LOAD_FAILED:"JSONRPC_009",JSONRPC_UNKNOWN_RESPONSE_ID:"JSONRPC_010",CHAT_GET_STATUS_FAILED:"CHAT_001",CHAT_SEND_FAILED:"CHAT_002",CHAT_CANCEL_FAILED:"CHAT_003",WS_CONNECTION_ERROR:"WS_001",WS_MESSAGE_PARSE_FAILED:"WS_002",WS_ERROR_EVENT:"WS_003",WS_EVENT_HANDLER_ERROR:"WS_004",WS_MAX_RECONNECT_ATTEMPTS:"WS_005",WS_SEND_FAILED:"WS_006",WS_NOT_CONNECTED:"WS_007",SPEC_CONVERSION_FAILED:"DATA_001",DATA_LOADER_SUCCESS_CALLBACK_FAILED:"DATA_002",DATA_LOADER_ERROR_CALLBACK_FAILED:"DATA_003",DATA_NORMALIZATION_FAILED:"DATA_004",DATA_LOADER_LOAD_FAILED:"DATA_005",ANNOTATION_CREATE_FAILED:"ANNOTATION_001",ANNOTATION_DELETE_FAILED:"ANNOTATION_002",ANNOTATION_RESOLVE_FAILED:"ANNOTATION_003",ANNOTATION_REPLY_FAILED:"ANNOTATION_004",ANNOTATION_DELETE_ROLLBACK_FAILED:"ANNOTATION_005",SESSION_STORAGE_PARSE_ERROR:"STORAGE_001",AUTH_COOKIE_DECODE_FAILED:"AUTH_001",AUTH_REQUEST_FAILED:"AUTH_002"};var t=(e=>(e.VALIDATION_ERROR="validation_error",e.NOT_FOUND="not_found",e.NETWORK_ERROR="network_error",e.TIMEOUT="timeout",e.UNAUTHORIZED="unauthorized",e.RATE_LIMITED="rate_limited",e.RESOURCE_EXHAUSTED="resource_exhausted",e.CONFLICT="conflict",e.EXTERNAL_SERVICE_ERROR="external_service_error",e.ASSERTION_FAILED="assertion_failed",e.INVALID_STATE="invalid_state",e.NOT_IMPLEMENTED="not_implemented",e.TYPE_ERROR="type_error",e.PARSE_ERROR="parse_error",e.LOGIC_ERROR="logic_error",e.NULL_REFERENCE="null_reference",e.INTERNAL_ERROR="internal_error",e))(t||{}),T=(e=>(e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e))(T||{}),a=(e=>(e.RETRY="retry",e.EXPONENTIAL_BACKOFF="exponential_backoff",e.FALLBACK="fallback",e.USER_ACTION="user_action",e.RELOAD="reload",e.NONE="none",e))(a||{});const s={network:/network|fetch|offline|connection|timeout|ERR_NAME_NOT_RESOLVED|ERR_INTERNET_DISCONNECTED/i,timeout:/timeout|timed out|deadline|took too long/i,networkDetail:{dns:/dns|name.*not.*resolved|ERR_NAME_NOT_RESOLVED/i,timeout:/timeout|timed out|deadline/i},unauthorized:/401|unauthorized|forbidden|not authorized|credentials/i,notFound:/404|not found|does not exist|resource.*not.*found/i,rateLimited:/429|rate limit|too many requests|quota|throttle/i,conflict:/409|conflict|duplicate|already.*exists|constraint/i,serverError:/500|502|503|504|internal.*error|service.*unavailable|gateway/i,validation:/validation|must be|required|bad request|email.*valid|password.*valid|field.*invalid/i,parseError:/parse|syntax|unexpected token|json|xml|invalid.*format/i,typeError:/type|not a function|is not a|undefined|null|cannot read|cannot set/i,resourceExhausted:/out of memory|quota|storage|disk|heap|too large|maximum/i,assertionFailed:/assertion.*failed|assert.*failed/i,invalidState:/invalid state|invariant|unreachable|should not happen/i,externalService:/third.?party|external|webhook|provider|service.*failed/i};function f(e,E,r,_){const O=Date.now(),n=r==null?void 0:r.stack,A=`${E} ${(r==null?void 0:r.message)||""}`.toLowerCase(),R=D(A,r),i=d(R,_),N=l(R),u=C(R,A),I=F(R,u),o=u&&U(R),S=m(R,E),c=M(_,R);return{errorId:e,message:E,originalError:r,category:R,severity:i,isExpectedFailure:N,isTransient:u,recoveryStrategy:I,canRetry:o,maxRetryAttempts:P(R),retryDelayMs:p(R),context:_,userFacingMessage:S,devMessage:h(R,E,r),timestamp:O,stackTrace:n,affectedFeatures:c}}function D(e,E){return E instanceof TypeError?t.TYPE_ERROR:E instanceof SyntaxError?t.PARSE_ERROR:E instanceof RangeError?t.RESOURCE_EXHAUSTED:s.network.test(e)?s.networkDetail.timeout.test(e)?t.TIMEOUT:(s.networkDetail.dns.test(e),t.NETWORK_ERROR):s.timeout.test(e)?t.TIMEOUT:s.unauthorized.test(e)?t.UNAUTHORIZED:s.notFound.test(e)?t.NOT_FOUND:s.rateLimited.test(e)?t.RATE_LIMITED:s.conflict.test(e)?t.CONFLICT:s.serverError.test(e)?t.EXTERNAL_SERVICE_ERROR:s.assertionFailed.test(e)?t.ASSERTION_FAILED:s.validation.test(e)&&!s.invalidState.test(e)&&!s.assertionFailed.test(e)?t.VALIDATION_ERROR:s.invalidState.test(e)?t.INVALID_STATE:s.parseError.test(e)?t.PARSE_ERROR:s.typeError.test(e)?t.TYPE_ERROR:s.resourceExhausted.test(e)?t.RESOURCE_EXHAUSTED:s.externalService.test(e)?t.EXTERNAL_SERVICE_ERROR:t.INTERNAL_ERROR}function d(e,E){return E!=null&&E.isCritical||e===t.ASSERTION_FAILED||e===t.INVALID_STATE||e===t.NULL_REFERENCE||e===t.TYPE_ERROR?T.CRITICAL:e===t.UNAUTHORIZED||e===t.NETWORK_ERROR||e===t.TIMEOUT||e===t.EXTERNAL_SERVICE_ERROR?T.HIGH:e===t.VALIDATION_ERROR||e===t.NOT_FOUND||e===t.PARSE_ERROR||e===t.CONFLICT?T.MEDIUM:e===t.RATE_LIMITED||e===t.RESOURCE_EXHAUSTED?T.LOW:T.MEDIUM}function l(e){return[t.VALIDATION_ERROR,t.NOT_FOUND,t.NETWORK_ERROR,t.TIMEOUT,t.UNAUTHORIZED,t.RATE_LIMITED,t.RESOURCE_EXHAUSTED,t.CONFLICT,t.EXTERNAL_SERVICE_ERROR,t.PARSE_ERROR].includes(e)}function C(e,E){const r=[t.NETWORK_ERROR,t.TIMEOUT,t.RATE_LIMITED,t.EXTERNAL_SERVICE_ERROR];return e===t.RESOURCE_EXHAUSTED?!E.includes("permanent")&&!E.includes("quota"):r.includes(e)}function F(e,E){return e===t.ASSERTION_FAILED||e===t.INVALID_STATE||e===t.NOT_IMPLEMENTED||e===t.TYPE_ERROR||e===t.NULL_REFERENCE||e===t.LOGIC_ERROR?a.NONE:e===t.NETWORK_ERROR&&E||e===t.TIMEOUT&&E||e===t.EXTERNAL_SERVICE_ERROR&&E||e===t.RATE_LIMITED?a.EXPONENTIAL_BACKOFF:e===t.UNAUTHORIZED||e===t.VALIDATION_ERROR||e===t.NOT_FOUND?a.USER_ACTION:e===t.CONFLICT?a.FALLBACK:(e===t.PARSE_ERROR,a.NONE)}function U(e){return[t.NETWORK_ERROR,t.TIMEOUT,t.RATE_LIMITED,t.EXTERNAL_SERVICE_ERROR,t.RESOURCE_EXHAUSTED].includes(e)}function P(e){switch(e){case t.NETWORK_ERROR:case t.TIMEOUT:return 3;case t.EXTERNAL_SERVICE_ERROR:return 2;case t.RATE_LIMITED:return 1;case t.RESOURCE_EXHAUSTED:return 2;default:return}}function p(e){switch(e){case t.NETWORK_ERROR:return 500;case t.TIMEOUT:return 1e3;case t.EXTERNAL_SERVICE_ERROR:return 1e3;case t.RATE_LIMITED:return 5e3;case t.RESOURCE_EXHAUSTED:return 2e3;default:return}}function m(e,E){switch(e){case t.NETWORK_ERROR:return"Network connection failed. Please check your internet connection.";case t.TIMEOUT:return"The operation took too long. Please try again.";case t.UNAUTHORIZED:return"Your session has expired. Please log in again.";case t.NOT_FOUND:return"The requested resource was not found.";case t.RATE_LIMITED:return"Too many requests. Please wait before trying again.";case t.RESOURCE_EXHAUSTED:return"System resources are temporarily exhausted. Please try again.";case t.VALIDATION_ERROR:return`Invalid input: ${E}`;case t.CONFLICT:return"This resource has been modified by someone else. Please refresh and try again.";case t.EXTERNAL_SERVICE_ERROR:return"External service is temporarily unavailable. Please try again.";case t.PARSE_ERROR:return"Unable to process the response. Please try again or contact support.";case t.ASSERTION_FAILED:case t.INVALID_STATE:case t.TYPE_ERROR:case t.NULL_REFERENCE:case t.INTERNAL_ERROR:return"An unexpected error occurred. Please refresh the page or contact support.";default:return"An error occurred. Please try again."}}function h(e,E,r){var n;return[`[${((n=Object.entries(t).find(([,A])=>A===e))==null?void 0:n[0])||"UNKNOWN"}] ${E}`,r!=null&&r.message?`Original: ${r.message}`:""].filter(Boolean).join(" | ")}function M(e,E){const r=[];return e!=null&&e.feature&&typeof e.feature=="string"&&r.push(e.feature),e!=null&&e.layer&&typeof e.layer=="string"&&r.push(`${e.layer}_layer`),E===t.NETWORK_ERROR?r.push("data_sync","websocket","api_calls"):E===t.EXTERNAL_SERVICE_ERROR&&r.push("export","integrations"),[...new Set(r)]}function v(e,E,r,_){const O=new Date().toISOString(),n=f(e,E,_,r),A={errorId:e,message:E,timestamp:O,context:r||{},category:n.category,severity:n.severity,isExpectedFailure:n.isExpectedFailure,isTransient:n.isTransient,recoveryStrategy:n.recoveryStrategy,canRetry:n.canRetry,affectedFeatures:n.affectedFeatures};if(typeof window<"u")try{const R=window.__SENTRY__;if(R&&R.captureException){const i=_||new Error(E);i.errorId=e,i.context=r,i.category=n.category,i.severity=n.severity,i.isExpectedFailure=n.isExpectedFailure,i.isTransient=n.isTransient,i.recoveryStrategy=n.recoveryStrategy,R.setTag("error_id",e),R.setTag("error_category",n.category),R.setTag("error_severity",n.severity),R.setTag("is_expected",String(n.isExpectedFailure)),R.setTag("is_transient",String(n.isTransient)),R.captureException(i)}}catch(R){console.warn("[ErrorTracker] Failed to capture error in Sentry:",R instanceof Error?R.message:String(R),{errorId:e,message:E})}if(e!==L.SESSION_STORAGE_PARSE_ERROR&&typeof sessionStorage<"u")try{const R="app:error_log",i=sessionStorage.getItem(R),N=i?JSON.parse(i):[];N.push(A),N.length>50&&N.shift(),sessionStorage.setItem(R,JSON.stringify(N))}catch(R){console.warn("[ErrorTracker] Failed to store error log in session storage:",R instanceof Error?R.message:String(R),{errorId:e,message:E})}return n}function H(e,E){const r=new Date().toISOString();if(console.warn(e,""),typeof sessionStorage<"u")try{const _="app:warning_log",O=sessionStorage.getItem(_),n=O?JSON.parse(O):[];n.push({message:e,timestamp:r,context:E||{}}),n.length>50&&n.shift(),sessionStorage.setItem(_,JSON.stringify(n))}catch(_){console.warn("[ErrorTracker] Failed to store warning log in session storage:",_ instanceof Error?_.message:String(_),{message:e})}}export{L as E,H as a,v as l};
