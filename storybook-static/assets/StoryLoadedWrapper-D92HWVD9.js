import{r,j as i}from"./iframe-DSSgKmXl.js";function I({children:v,testId:u,onLayoutComplete:n,onTimeout:o,throwOnTimeout:f}){const[R,E]=r.useState(!1),[S,W]=r.useState(!1),[p,L]=r.useState(null),t=r.useRef(null),e=r.useRef(null),c=r.useRef(!1),s=r.useRef(0),m=r.useRef(!1);return r.useEffect(()=>{s.current=Date.now();const g=()=>{var T,h,w;if(!t.current||c.current)return;const l=t.current.querySelectorAll(".react-flow__node");if(l&&l.length>0){const a=Date.now()-s.current;console.log(`StoryLoadedWrapper: Loaded in ${a}ms with ${l.length} nodes`),c.current=!0,E(!0),e.current!==null&&(clearInterval(e.current),e.current=null),n==null||n()}else if(Date.now()-s.current>3e4){const a=Date.now()-s.current,d={maxWaitTime:3e4,actualWaitTime:a,wrapperElement:t.current,childrenCount:((T=t.current)==null?void 0:T.children.length)||0,innerHtmlPreview:((h=t.current)==null?void 0:h.innerHTML.substring(0,500))||""};if(console.error("StoryLoadedWrapper: Timeout waiting for React Flow nodes after 30s"),console.error("Wrapper element:",(w=t.current)==null?void 0:w.tagName),console.error("Children count:",d.childrenCount),console.error("Inner HTML (first 500 chars):",d.innerHtmlPreview),!m.current&&(m.current=!0,W(!0),o==null||o(d),f)){const y=`StoryLoadedWrapper timeout: React Flow nodes not found after ${a}ms`,x=new Error(y);L(x),console.error(y)}e.current!==null&&(clearInterval(e.current),e.current=null)}},_=setTimeout(()=>{g(),c.current||(e.current=setInterval(g,100))},100);return()=>{clearTimeout(_),e.current!==null&&(clearInterval(e.current),e.current=null)}},[n,o,f]),p?i.jsxs("div",{ref:t,"data-testid":u,"data-storyloaded":"error",role:"alert",style:{padding:16,color:"#dc2626",backgroundColor:"#fee2e2",border:"1px solid #fca5a5"},children:[i.jsx("div",{style:{fontWeight:600,marginBottom:8},children:"Story Load Error"}),i.jsx("div",{style:{fontSize:14},children:p.message})]}):i.jsx("div",{ref:t,"data-testid":u,"data-storyloaded":R?"true":S?"timeout":void 0,children:v})}I.displayName="StoryLoadedWrapper";I.__docgenInfo={description:"",methods:[],displayName:"StoryLoadedWrapper",props:{children:{required:!0,tsType:{name:"ReactNode"},description:"Content to wrap"},testId:{required:!0,tsType:{name:"string"},description:"Test ID for selecting the wrapper in tests"},onLayoutComplete:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"Optional callback when layout is complete"},onTimeout:{required:!1,tsType:{name:"signature",type:"function",raw:"(diagnostics: TimeoutDiagnostics) => void",signature:{arguments:[{type:{name:"TimeoutDiagnostics"},name:"diagnostics"}],return:{name:"void"}}},description:"Optional callback when timeout occurs - allows tests to detect and handle failures"},throwOnTimeout:{required:!1,tsType:{name:"boolean"},description:"Optional flag to throw error instead of just setting state on timeout"}}};export{I as S};
